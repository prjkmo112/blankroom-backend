generator client {
  provider      = "prisma-client-js"
  output        = "./generated"
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model rooms {
  id            String          @id @default(dbgenerated("gen_random_uuid()"))
  short_id      String          @unique
  name          String
  description   String?
  password      String?         @db.Char(6)
  created_at    DateTime?       @default(now()) @db.Timestamptz(6)
  boards        boards?
  chat_messages chat_messages[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model boards {
  room_id    String    @id
  image_data Bytes
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  rooms      rooms     @relation(fields: [room_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users {
  id            String          @id @default(dbgenerated("gen_random_uuid()"))
  userid        String          @unique
  password      String
  nickname      String
  created_at    DateTime?       @default(now()) @db.Timestamptz(6)
  chat_messages chat_messages[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model chat_messages {
  id         String    @id @default(dbgenerated("gen_random_uuid()"))
  room_id    String
  user_id    String
  message    String
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  rooms      rooms     @relation(fields: [room_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([room_id, created_at], map: "idx_chat_messages_room_id_created_at")
  @@index([user_id], map: "idx_chat_messages_user_id")
}
